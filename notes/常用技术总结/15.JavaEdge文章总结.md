

# JavaEdge

## 专栏

### Redis



#### 1、Redis读写分离

总结：

单机 redis 承载 qps 在上万到几万不等

单机 redis 几乎不太可能说QPS超过10万+，除非机器性能特别好

为了达到 QPS 超过10万+，可以采取主从架构，将读写请求进行分离，可以支撑10万+都QPS的架构

水平扩容：如果读 QPS 再增加，继续增加 redis slave 即可。



#### 2、Redis键过期策略、内存淘汰策略详解

总结：

- 对已经有过期时间的`key`执行`EXPIRE`操作，将会更新它的过期时间。有很多应用有这种业务场景，例如记录会话的session。
- 可使用 EXPIRE 和 PERSIST 命令（或其他严格命令）更新或完全删除生存的关键时间。
- 在 Redis 2.4 中，过期可能不准确，并且可能介于 0 到 1 秒之间。 Redis 2.6，过期误差从 0 到 1 毫秒。



#### 3、集群和分布式的区别是什么？

- 分布式：不同的业务模块拆分到不同的机器上，解决高并发的问题。 工作形态 redis服务器各工作方式不同一般称为Redis分布式
- 集群：同一个业务部署在多台机器上，提高系统可用性 是物理形态,一般称Tomcat集群



#### 4、大厂的Redis分布式锁是如何设计的

方案：使用 setnx 设置锁，并设置锁的过期时间，需要将（设置锁+设置锁的过期时间）设置为原子操作，以防设置锁之后没有成功设置过期时间，导致死锁，在执行完自己的业务之后，需要删除锁（这里需要设置锁的UUID，以访 A 业务的锁过期之后，B 业务拿到锁，此时 A 业务执行完毕，去删除锁，将 B 业务的锁误删掉），删除锁的操作需要判断 UUID 是自己的锁才可以进行删除锁，这里需要使用 lua 脚本将（判断 UUID + 删除锁）的操作设置为原子操作。

生产方案：

使用 Redisson 第三方类库，执行流程：（只要线程一加锁成功，就会启动一个watch dog看门狗，它是一个后台线程，会每隔10秒检查一下（锁续命周期就是设置的超时时间的三分之一），如果线程还持有锁，就会不断的延长锁key的生存时间。因此，Redis就是使用Redisson解决了**锁过期释放，业务没执行完**问题。当业务执行完，释放锁后，再关闭守护线程。

这种方案是针对单机版的讨论。

如果使用 redis 集群部署，当 master 加锁之后，master 宕机，选择一个 slave 当 master，又可以重复加锁了，于是出现了更高级的分布式锁算法：RedLock

原理：搞多个Redis master部署，以保证它们不会同时宕掉。并且这些master节点是完全相互独立的，相互之间不存在数据同步。同时，需要确保在这多个master实例上，是与在Redis单实例，使用相同方法来获取和释放锁。当超过半数的redis节点加锁成功才算成功获取锁

总结：单机Redis使用Redisson普通分布式锁即可，集群Redis使用RedLock加锁。



#### 5、Redis6新特性（自己整理）https://blog.csdn.net/xp_lx1/article/details/125058895

- Redis6引入多线程

原因：随着硬件性能提升，redis的性能瓶颈可能出现网络IO的读写，也就是：**单个线程处理网络读写的速度跟不上底层网络硬件的速度。**

**注意的是，redis多IO线程模型只用来处理网络读写请求，对于redis的读写命令，依然是单线程处理。**

- 支持ACL

  Redis提供了一个新的命令ACL来维护Redis的访问控制信息，详情见： https://redis.io/topics/acl

  Redis 6开始支持ACL，该功能通过限制对命令和key的访问来提高安全性。ACL的工作方式是在连接之后，要求客户端进行身份验证（用户名和有效密码）；如果身份验证阶段成功，则连接与指定用户关联，并且该用户具有限制。
  在默认配置中，Redis 6的工作方式与Redis的旧版本完全相同，每个新连接都能够调用每个可能的命令并访问每个键，因此ACL功能与旧版本向后兼容。客户和应用程序。依旧使用requirepass配置密码的，但现在只是为默认用户设置密码。



#### 6、全网最权威！Redis官方对比分布式缓存Redis V.S Memcached

在分布式系统开发中，系统与系统之间都属于进程级别，缓存系统也能跨进程叫分布式缓存，市面上分布式缓存技术有 Memcached 和 Redis。
性能上都很出色，具体到细节，由于 Redis 只使用单核，而 Memcached 可以使用多核，所以平均每一个核上 Redis 在存储小数据时比 Memcached 性能更高。

而在 100K 以上的数据中，Memcached 性能要高于 Redis，虽然 Redis 最近也在存储大数据的性能上进行优化，但是比起 Memcached，还是稍有逊色。

MemCached 可以修改最大内存，采用 LRU 算法。Redis 增加了 VM 的特性，突破了物理内存的限制。

MemCached 数据结构单一，仅用来缓存数据，而 Redis 支持更加丰富的数据类型，也可以在服务器端直接对数据进行丰富的操作, 这样可以减少网络 IO 次数和数据体积。


#### 未完



## Netty

