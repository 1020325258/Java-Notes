

- 多看优秀的场景设计文章、
- 性能优化：https://wx.zsxq.com/dweb2/index/topic_detail/214251284118481



# 场景题

1. 场景题：匹配系统，一个用户多次匹配，要求不能匹配重复的人，之后双方都点击确认开始聊天。

   答：对于用户不可以匹配重复的人，可以使用 bitmap 来做。

2. 实现短信验证码生成和验证两个功能，只能使用Java语言，不能使用Redis等外部存储工具。

3. 如果抽奖项目真正应用于实际还有哪些地方需要改进？


   答：目前架构、设计、实现上已经做了很多的优化方案，但上线肯定是会有很多的业务场景的细节，需要技术处理。为了更好的适配这些场景，在实现上留出扩展、在系统上添加监控、在日志上做好排查等。

   代码的扩展性、系统的可用性


# Mysql

1. 为什么 mysql 删了行记录，反而磁盘空间没有减少？（软删除）





# 锁

1. 什么是滑块锁?





# 消息队列

1. 除了使用 mq 解耦发奖流程外，有没有别的解决方案？


   答：异步MQ的方案非常成熟，也没有见到其他更合适的方案（如果面试官问了，可以反问他）

   这里mq的用途可以看作是中转分流的任务。中转分流不止MQ可以做，网关也是在中转分流，只不过是没有存储功能。

   无非就是你设计一个能分发任务的路由层，保证任务分发前别丢了，就行。这就是思想，出题人要的是这个。然后再谈具体实现，这又是基本功了。






# 性能

1. 如果让你来评估项目的QPS的话，你会用什么方式来评估?(补充: 不要做压测，就通过现在的设计以
   及硬件配置推导OPS应该达到什么水准?)

   答：首先需要根据业务提供的推广规模、渠道、人数，来评估。- 这里前面按照28法则评估过。

   - 假如系统有1000万用户，那么每天来点击页面的占比20%，也就是200万用户访问。
   - 假设平均每个用户点击50次，那么总用有1亿的PV（页面浏览量）
   - 一天24个小时，平均活跃时间段算在5个小时内【24*20%】，那么5个小时预计有8000万点击，也就是平均每秒4500个请求。
   - 4500是一个均值，按照电商类峰值的话，一般是3~4倍均值量，也就是5个小时每秒18000个请求【QPS=1.8万】

2. 比如说: 16核64G的机器，普通机械硬盘，这种情况下让你来做秒杀的系统，你会去修改和配置哪些参数?(不考虑redis、kafka等，只考虑springboot的应用)

   答：如果这么个机器，一般会拆分4核16G 的4台虚拟机，之后是 JVM、Tomcat 的参数配置。与大家提到的点一致。拆分为4台虚拟机之后，相当于是互备容灾。

   不存在64G内存机器的配置，在云原生时代，大家更倾向于用小机器组成阵列，去扛流量。不够就伸缩，到阿里云去买公有云，这就要求你10分钟能上架应用。（微博的XX出轨应对策略，也是这个意思，加机器抗流量）

   因此在答这道题时，需要首先关注的就是配置上的缺陷，之后再去解决JVM配置调优的问题。

3. JVM的堆配置过大的副作用有哪些?

   答：垃圾回收慢，有延迟，回收频繁，也会导致碎片化严重。同时还会因为更多的占用内存和CPU导致资源竞争。

4. .接上面，SpringBoot和JVM需要配置的参数还有哪些?

   答：主要集中在池化和组件的使用配置上，如；线程池、连接池、RPC重试和超时等

5. .秒杀场景下用哪种垃圾回收器合适?

   答：基本就是G1，但估计想让你解释下 G1 【分代收集、并发标记、区域回收、自适应调整】- 理由；在秒杀场景中，由于请求量大、并发高，需要尽量减少应用的停顿时间，以提高系统的响应速度和吞吐量。



6. Full GC卡顿时间长短跟什么有关系? 如果堆大小为128G的话，Full GC可能停顿多久?

   答：堆大小、垃圾回收器，此场景快速秒杀就结束了，预计也就在百十毫秒。如果更准确这个就太依赖于环境配置的验证了。






# JVM

1. 写代码时候有没有什么方式尽量减少Full GC的概率?

   答：(1)避免一次性加载大量数据加载到内存，比如excel导入导出，jdbc数据库查询
   (2)避免大对象的代码处理业务链流程过长，比如aop中获取到了对象参数，大对象捕获到了，导致对象生命周期变长了，没及时释放。
   (3)禁止使用system.gc方法
   (4)、避免在使用threalocal后，未主动调用remove方法

   尽量避免大对象的使用，以及频繁的创建和销毁。更要避免全局锁的竞争等。

   爱海贼的无处不在：这几个面试题偏向于实战经验，不是特别虚，一方面考察相关系统性的优化、基础的使用和整合能力。
   个人想法不一定对，后续看看地表最强架构师小傅哥的想法。
   1、第3题：有标准或比较靠谱的答案，之前星球无数次回答了，二八原则那块
   2、第4题：Tomcat修改为undertow服务器、Tomcat最大并发连接数、业务线程池大小，JVM请求参数大小、代码上面（减少循环和计算的次数、相关字符串用常量编写、相关对象使用完主动设置为null，通过信号量semaphre那玩意控制秒杀消费时的速率，多部署几个节点提高吞吐量等等）、监控方面（部署上prometheus+grafana监控）、内存缓存标志位(如果秒杀失败或库存没了，可以在内存中设置个标志位，避免打入到redis，进一步提高，以前图灵老师讲过这个方式)
   3、第2题就看你是否足够了解【系统】这个东西，优化方向和待开发的功能项是非常多的。不仅仅是技术上，也可以是业务上的。（如果你认真的研究过真实的秒杀业务的现象，还有很多事情需要做）
   4、第9题：个人经验如下：
   ​